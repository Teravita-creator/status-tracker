<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Подсчёт времени по статусам</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #0b0f17; color: #e8eefc; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 24px; }
    h1 { margin: 0 0 14px; font-size: 20px; font-weight: 700; }
    .grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 16px; }
    @media (max-width: 980px) { .grid { grid-template-columns: 1fr; } }
    .card { background: #121a2a; border: 1px solid #23304d; border-radius: 14px; padding: 14px; }
    label { display: block; font-size: 12px; color: #b9c6e6; margin-bottom: 6px; }
    textarea { width: 100%; min-height: 260px; resize: vertical; border-radius: 12px; border: 1px solid #2b3a5e; background: #0f1626; color: #e8eefc; padding: 10px; outline: none; }
    input, select { width: 100%; border-radius: 12px; border: 1px solid #2b3a5e; background: #0f1626; color: #e8eefc; padding: 10px; outline: none; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .btns { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    button { cursor: pointer; border-radius: 12px; border: 1px solid #2b3a5e; background: #1a2a4a; color: #e8eefc; padding: 10px 14px; font-weight: 600; }
    button:hover { filter: brightness(1.08); }
    .muted { color: #b9c6e6; font-size: 12px; }
    table { width: 100%; border-collapse: collapse; border-radius: 12px; border: 1px solid #23304d; overflow: hidden; }
    th, td { padding: 10px; border-bottom: 1px solid #23304d; vertical-align: top; }
    th { text-align: left; font-size: 12px; color: #b9c6e6; background: #0f1626; }
    tr:last-child td { border-bottom: none; }
    .kpi { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .kpi .box { border: 1px solid #23304d; background: #0f1626; border-radius: 12px; padding: 10px; }
    .kpi .val { font-size: 18px; font-weight: 800; }
    .kpi .cap { font-size: 12px; color: #b9c6e6; }
    .note { margin-top: 10px; }
    .chk { display:flex; gap:10px; align-items:flex-start; padding:10px; border:1px solid #23304d; background:#0f1626; border-radius:12px; }
    .chk input { width: 18px; height: 18px; margin-top: 2px; }
    code { background:#0f1626; padding:2px 6px; border-radius:8px; border:1px solid #23304d; }
     tr.warn td { background: rgba(255, 180, 0, 0.10); }
.badge-warn { display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #23304d; background:#0f1626; font-size:12px; }
  
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Подсчёт времени оператора по статусам</h1>

    <div class="grid">
      <div class="card">
        <label>Вставьте данные (Id, Действие, Оператор, Заказ, Дата)</label>
        <textarea id="input" placeholder="Вставьте сюда данные из CRM..."></textarea>

        <div class="btns">
          <button id="calcBtn">Подсчитать</button>
          <button id="clearBtn" type="button">Очистить</button>
        </div>

        <div id="messages" class="muted note"></div>

        <div class="muted note">
          Подсчёт идёт по интервалам между событиями в выбранном окне расчёта (смена).
        </div>
      </div>

      <div class="card">
        <div class="row">
  <div>
    <label>Оператор</label>
    <select id="operatorSelect">
      <option value="__ALL__">Все</option>
    </select>
  </div>
  <div>
    <label>Игнорировать интервалы короче (сек)</label>
    <input id="minGapSec" value="0" placeholder="например 2" />
  </div>
</div>

<div style="height:10px"></div>

<div class="row">
  <div>
    <label>Порог “большого разрыва” (мин) между “Статус в работе” → “Открытие заказа”</label>
    <input id="gapWarnMin" value="30" placeholder="например 10" />
  </div>
  <div class="muted" style="align-self:end;">
    Если интервал больше порога — строка в “Интервалы” помечается ⚠️
  </div>
</div>


        <div style="height:10px"></div>

        <div class="chk">
          <input id="acwModeB" type="checkbox" checked />
          <div>
            <div style="font-weight:700;">
              Вариант B: после закрытия относить время до следующего открытия к “Статус в работе”
            </div>
            <div class="muted">
              Период <code>Закрытие заказа → следующее Открытие заказа</code> будет засчитан как
              <b>“Статус в работе”</b>.
            </div>
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <div>
            <label>Начало смены (YYYY-MM-DD HH:MM:SS)</label>
            <input id="shiftStart" placeholder="например 2026-02-16 09:47:28" />
          </div>
          <div>
            <label>Конец смены (YYYY-MM-DD HH:MM:SS)</label>
            <input id="shiftEnd" placeholder="например 2026-02-16 19:00:34" />
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="kpi">
          <div class="box">
            <div class="val" id="kpiTotal">—</div>
            <div class="cap">Общее время (окно расчёта)</div>
          </div>
          <div class="box">
            <div class="val" id="kpiRows">—</div>
            <div class="cap">Записей использовано</div>
          </div>
        </div>

        <div class="muted note">
          Если статус не определён, интервал не засчитывается. В таблице “Интервалы” видно, какой статус применился
          и был ли интервал учтён.
        </div>
      </div>
    </div>

    <div style="height:16px"></div>

    <div class="grid">
      <div class="card">
        <h1 style="font-size:16px;margin:0 0 10px;">Итог по статусам</h1>
        <div id="summaryWrap" class="muted">Нет данных.</div>
      </div>

      <div class="card">
        <h1 style="font-size:16px;margin:0 0 10px;">Интервалы (для проверки)</h1>
        <div id="intervalsWrap" class="muted">Нет данных.</div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
